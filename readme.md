# Задача: создать код для новых виджетов системы Искра.

Все виджеты сделаны на чистом JavaScript без использования сторонних фреймворков. Никакие дополнительные файлы (js/стили) не должны загружаться. При запуске виджета происходит проверка того, что виджет не был запущен ранее.

## 1. Блок отзывов о товаре

Состав: JS-код, PHP-обработчик, MySQL-таблица для отзывов.

Пример вёрстки прилагается.

Виджет получает ID товара из атрибута *content* тэга *meta[name="iskra-page-offer"]* и формирует блок отзывов о товаре в HTML-блоке с *id="iskra-feedback"*. Если блока нет, то будет выдано предупреждение в console.log. Ключ сайта берется из параметра *key* тэга *script[src *= 'stcl.js']*.

При загрузке виджета происходит асинхронный запрос на сервер и получение перечня отзывов для данного ID товара и ключа сайта. При добавлении отзыва на сервер передается оценка (1-5 звёзд), текст отзыва, ID товара и ключ сайта.

Конфигурация: URL серверной части, ID тэгов, количество показанных отзывов, возможность самостоятельно оставлять отзыв задается в коде виджета через константы.

Требование к PHP-бэкенду: отдает список отзывов с оценками и принимает новые отзывы для заданного ключа и ID товара. Хранит в таблице поле *allowed* (тип enum) с информацией о возможности показа отзыва (т.е. любой отзыв можно открыть или закрыть для показа). Имеет настройку, позволяющую устанавливать *allowed='Yes'* или *allowed='No'* по умолчанию для каждого ключа.

## 2. Сборщик email-адресов

Состав: JS-код.
Вёрстка делается самостоятельно.

При инициализации виджета начинается контроль действий пользователя.

При долгой неактивности или скроллинге на самый верх после скроллинга вниз, либо при перемещении курсора в верхний левый или правый угол экрана появляется окно с предложением оставить свой email и подписаться на рассылку.

При оставлении email происходит вызов

`if (stcl && stcl.target)
    stcl.target("Подписка на рассылку", {"Email":client@email.com});`

и окно закрывается.

Конфигурация: стили окна, необходимость контроля скорллинга, неактивности или перемещения курсора задаются в начале кода виджета через константы.

## 3. Картинка при первом входе

Состав: JS-код.

Вёрстка делается самостоятельно.

При инициализации виджета появляется pop-up картинка с крестиком в случае, если не установлена cookie iskra_popup_[MD5(url_картинки)]. Вместо MD5 можно использовать любую хэш-функцию.

При закрытии окна устанавливается данная cookie, тем самым блокируя показы той же картинки при следующем заходе пользователя.

Конфигурация: url_картинки, стили и местоположение pop-up (слева/справа/по центру, вверху/внизу/по центру) задаются в начале кода виджета через константы.

## 4. Звонок с сайта

Состав: JS-код, PHP-обработчик, MySQL-таблица с логом запросов.

Вёрстка делается самостоятельно.

При инициализации виджета появляется картинка с телефоном (картинку выбрать самостоятельно и согласовать). При наведении на картинку возможна какая-то анимация.

При нажатии на картинку появляется панель с предложением ввести номер телефона и выбором времени звонка. В случае возможности заказать звонок прямо сейчас также отображается количество секунд для обратного отсчета. При заказе звонка "прямо сейчас" счетчик секунд начинает отсчет и доходит до 0, после чего появляется слово «Звонок».

Конфигурация: время суток по дням недели для отображения картинки и для выбора в меню, а также изначальное значение счетчика при звонке "прямо сейчас" задаются в начале кода виджета через константы.

PHP-бэкенд получает запрос с ключом, временем звонка и номером телефона и отправляет письмо на указанный для данного ключа email.

